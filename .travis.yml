language: python
sudo: false
env:
- LUA="lua=5.2"
- LUA="lua=5.3"
- LUA="luajit=2.0"
- LUA="luajit=2.1"
before_install:
- pip install hererocks
- hererocks lua_install -r^ --$LUA
- export PATH=$PATH:$PWD/lua_install/bin
install:
- luarocks install luacheck
- luarocks install busted
- luarocks install luacov
- luarocks install luacov-coveralls
- luarocks install luafilesystem
script:
- luacheck main.lua ./moonpie
- busted --run=travis
after_success:
- echo $TRAVIS_BUILD_DIR/lua_install
- luacov-coveralls --exclude $TRAVIS_BUILD_DIR/lua_install/share --exclude ./ext
before_deploy:
- cd $TRAVIS_BUILD_DIR
- zip -r -x.git/* -xlua_install/* $TRAVIS_BUILD_DIR/../moonpie-$TRAVIS_TAG-$TRAVIS_BUILD_NUMBER.love ./
- zip -r -x.git/* $TRAVIS_BUILD_DIR/../moonpie-lib-$TRAVIS_TAG-$TRAVIS_BUILD_NUMBER.zip ./moonpie
deploy:
  provider: releases
  api_key:
    secure: "sfqPwrnfTL4fjCJaKPJwji6FLC24sZ4MoZh5kgQgOKXRX4JH+VqFBLFs41+Ezo6zZsH8CVbXCbnWK7FEFL85B0/MX+ahOs5q9EusreWT+SHaQx1jqR7vpFvuHFUGLvbU50gbheEE0fSoZwVLpjlwaVrseNWu6BsUF4BLv9c8cO7T46lo002i79WKWJx1L/PNVjWsXSXFc89O1qS958Xdnfj82dHYU5p8QsGvoJw7rh7hNHi3o+xTWUbez9fMzwCI/yI/MxVOP2DA14iUBJdqRPgrBa5mXdn6nqKie9bMUz84C1izkyxx7Ck4OzBuUlotHeYz4DDGsvWuYuRwmmA+3imKVNoq6l5+zmcqBW9Jo/JZNC3qlu855TdV8BtRMyhLXjMZoIDDmDfBuQV01C4T2HXCErza2aS/PXE4QQc6fETNw/7Oum8ri6vuLgkPAHw2UOHOH1ifazRovtBJAACOyfTG4NIktUIQjNHGF0mu5HzTS1jihsENy6vLVK6ETI/QaKVBxGG/Foknzbh8eURq7txCQg5KSzxFfDk7yPVIz4HVOaPH6rgNDe7kfGaNlXFQxdrh/X1tDyg0lxtcX81Y1GHQejPJYX8fUyX9/u94PexPzNnm9r2oGAaQWABF3FMBGI/FHdKlGeIBVebpyGByVmKoacusZN80D5+XBBuHpn0="
  file: 
    - $TRAVIS_BUILD_DIR/../moonpie-$TRAVIS_TAG-$TRAVIS_BUILD_NUMBER.love
    - $TRAVIS_BUILD_DIR/../moonpie-lib-$TRAVIS_TAG-$TRAVIS_BUILD_NUMBER.zip
  on:
    repo: tredfern/moonpie
    tags: true  
    condition: $LUA =~ ^luajit=2.1$
      
